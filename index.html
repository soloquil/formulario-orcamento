<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orçamento Vinicius Barbaro Films</title>
  <style>
    body { margin:0; font-family:'Segoe UI',sans-serif; background:#fdfdfd url('https://www.transparenttextures.com/patterns/white-marble.png'); color:#2b2b2b; }
    header { background:#0f3d57; color:#fff; padding:1rem; text-align:center; font-size:1.8rem; }
    .step { display:none; max-width:700px; margin:2rem auto; background:#fff; padding:2rem; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.1);}   
    .step.active { display:block; }
    h2 { color:#0f3d57; margin-bottom:1rem; }
    label { display:block; margin:0.5rem 0; font-weight:500; }
    select,input[type="number"],input[type="time"] { width:48%; padding:0.5rem; margin:0.5rem 1%; border:1px solid #ccc; border-radius:6px; }
    .checkbox-group label { display:inline-block; margin-right:1rem; }
    button { background:#0f3d57; color:#fff; border:none; padding:0.8rem 1.5rem; border-radius:8px; cursor:pointer; transition:0.3s; margin:0.5rem; }
    button:hover { background:#0d2e41; }
    .nav-buttons { text-align:right; }
    .footer { text-align:center; font-size:0.8rem; color:#888; margin:2rem 0; }
  </style>
</head>
<body>
  <header>Vinicius Barbaro Films – Orçamento</header>

  <script>
    let currentStep = 1, rows;
    const totalSteps = 7;
    const sel = { pre:[], duration:'', startTime:'', services:[], videoStyles:[], additional:[], address:'', preAddress:'' };

    function showStep(n) {
      for(let i=1;i<=totalSteps;i++) document.getElementById('step'+i).classList.remove('active');
      document.getElementById('step'+n).classList.add('active');
      currentStep = n;
    }
    function prevStep(){ if(currentStep>1) showStep(currentStep-1);}    
    function nextStep(){ if(currentStep<totalSteps) showStep(currentStep+1);}    

    async function loadSheet() {
      const resp = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vSU-fqjBfA2H6XvQl7iQj04dVs3ZcpLBpfe1oDshpchCKwM5xA2YDnDo3aErtDjH0C3rq0FjxljUkjo/pub?output=csv');
      const txt = await resp.text(); rows = txt.split('\n').map(r=>r.split(',')); initSteps();
    }
    function findTag(tag){ return rows.findIndex(r=>r[0]===tag); }
    function sliceSection(start,end){ const s=findTag(start), e=findTag(end); return (s>=0&&e>s)? rows.slice(s+1,e):[]; }

    function initSteps(){
      // Step1: Map
      initMap('map-evento', address=>sel.address=address);
      document.getElementById('step1-btns').innerHTML=`<button onclick="nextStep()">Continuar</button>`;
      
      // Step2: Pre-wedding options
      const pre= sliceSection('serviços-de-pré-wedding-inicial','serviços-de-pré-wedding-final');
      const d2=document.getElementById('prewedding-services'); pre.forEach(r=>{ d2.insertAdjacentHTML('beforeend',`<label class="checkbox-group"><input type="checkbox" value="${r[0]}"> ${r[0]}</label>`); });
      document.getElementById('step2-btns').innerHTML=`<button onclick="prevStep()">Voltar</button><button onclick="nextStep()">Continuar</button>`;

      // Step3: Duration & start
      const dur = sliceSection('duração-de-cobertura-inicial','duração-de-cobertura-final')[0]||[];
      const selDur=document.getElementById('coverage-duration'); dur.forEach((v,i)=>{ if(i>0) selDur.append(new Option(v,v)); });
      document.getElementById('step3-btns').innerHTML=`<button onclick="prevStep()">Voltar</button><button onclick="nextStep()">Continuar</button>`;

      // Step4: Services
      const serv= sliceSection('serviço-de-cobertura-inicial','serviço-de-cobertura-final');
      const d4=document.getElementById('coverage-services'); serv.forEach(r=>{ d4.insertAdjacentHTML('beforeend',`<label class="checkbox-group"><input type="checkbox" value="${r[0]}"> ${r[0]}</label>`); });
      document.getElementById('step4-btns').innerHTML=`<button onclick="prevStep()">Voltar</button><button onclick="nextStep()">Continuar</button>`;

      // Step5: Video styles
      const vid= sliceSection('estilos-de-video-inicial','estilos-de-video-final');
      const d5=document.getElementById('video-styles'); vid.forEach(r=>{ d5.insertAdjacentHTML('beforeend',`<label class="checkbox-group"><input type="checkbox" value="${r[0]}"> ${r[0]}</label>`); });
      document.getElementById('step5-btns').innerHTML=`<button onclick="prevStep()">Voltar</button><button onclick="nextStep()">Continuar</button>`;

      // Step6: Pre-map & additional
      initMap('map-pre', addr=>sel.preAddress=addr);
      const add= sliceSection('adicionais-de-filmagem-inicial','adicionais-de-filmagem-final');
      const d6=document.getElementById('additional-services'); add.forEach(r=>{ d6.insertAdjacentHTML('beforeend',`<label class="checkbox-group"><input type="checkbox" value="${r[0]}"> ${r[0]}</label>`); });
      document.getElementById('step6-btns').innerHTML=`<button onclick="prevStep()">Voltar</button><button onclick="nextStep()">Continuar</button>`;

      // Step7: summary
      document.getElementById('step7-btns').innerHTML=`<button onclick="prevStep()">Voltar</button><button onclick="enviarWhats()">Enviar WhatsApp</button>`;
    }
    function initMap(id,callback){
      const input=document.createElement('input'); input.placeholder='Busque o local';
      const div=document.getElementById(id); div.appendChild(input);
      // Simplified: no real map, but capture address
      input.onchange=()=>callback(input.value);
    }

    function getCoverageCost(){
      const duration=document.getElementById('coverage-duration').value;
      const multip= sliceSection('multiplicativo-para-numero-de-fornecedores-inicial','multiplicativo-para-numero-de-fornecedores-final');
      const services=sliceSection('serviço-de-cobertura-inicial','serviço-de-cobertura-final');
      const idxOrc = sliceSection('duração-de-cobertura-inicial','duração-de-cobertura-final')[0].indexOf(duration);
      let total=0;
      services.forEach(r=>{ const name=r[0]; const checked=document.querySelector(`#coverage-services input[value="${name}"]`).checked; if(checked){
        const price=parseFloat(r[idxOrc+1]||0);
        const cnt= parseInt(document.getElementById(name.toLowerCase().includes('filmagem')?'cin  egrafistas':'fotografos').value)||1;
        const multRow = multip.find(m=>parseInt(m[0])===cnt);
        const mult = multRow?parseFloat(multRow[1]):1;
        total += price * mult;
      }});
      return total;
    }
    function getDisplacementCost(km){
      const disp = sliceSection('valor-de-deslocamento-inicial','valor-de-deslocamento-final');
      for(const r of disp){ const limit=parseFloat(r[1]); if(km<=limit){ const perKm=parseFloat(r[2]), fix=parseFloat(r[3]); return km*perKm + fix; }}
      return 0;
    }
    async function enviarWhats(){
      // collect selections
      sel.pre = Array.from(document.querySelectorAll('#prewedding-services input:checked')).map(i=>i.value);
      sel.duration = document.getElementById('coverage-duration').value;
      sel.startTime = document.getElementById('start-time').value;
      sel.services = Array.from(document.querySelectorAll('#coverage-services input:checked')).map(i=>i.value);
      sel.videoStyles = Array.from(document.querySelectorAll('#video-styles input:checked')).map(i=>i.value);
      sel.additional = Array.from(document.querySelectorAll('#additional-services input:checked')).map(i=>i.value);
      // calc
      const covCost = getCoverageCost();
      const addCost = sel.additional.reduce((sum,nm)=>{ const row = sliceSection('adicionais-de-filmagem-inicial','adicionais-de-filmagem-final').find(r=>r[0]===nm); return sum + parseFloat(row[1]||0); },0);
      const preCost = sel.pre.reduce((sum,nm)=>{ const rowsP=sliceSection('serviços-de-pré-wedding-inicial','serviços-de-pré-wedding-final'); const r=rowsP.find(r=>r[0]===nm); return sum+parseFloat(r[1]||0); },0);
      const km = parseFloat(prompt('Informe distância aproximada (km):'));
      const dispCost = getDisplacementCost(km);
      const total = covCost + addCost + preCost + dispCost;
      // message
      let msg = `Olá! gostaria de falar sobre este orçamento:`;
      msg += `\nLocal evento: ${sel.address}`;
      msg += `\nPré-wedding: ${sel.pre.length?sel.pre.join(', '):'Não contratado'}`;
      msg += `\nCobertura: ${sel.duration} iniciar às ${sel.startTime}`;
      msg += `\nServiços: ${sel.services.join(', ')}`;
      msg += `\nEstilos vídeo: ${sel.videoStyles.join(', ')}`;
      msg += `\nAdicionais: ${sel.additional.join(', ')}`;
      msg += `\nDeslocamento (${km}km): R$ ${dispCost.toFixed(2)}`;
      msg += `\nTotal: R$ ${total.toFixed(2)}`;
      window.open(`https://wa.me/5511978894210?text=${encodeURIComponent(msg)}`,'_blank');
    }
    window.onload = loadSheet;
  </script>

  <div id="step1" class="step active">
    <h2>1. Local do Evento</h2>
    <div id="map-evento" style="width:100%;height:50px;"></div>
    <div id="step1-btns" class="nav-buttons"></div>
  </div>
  <div id="step2" class="step">
    <h2>2. Pré-Wedding</h2>
    <div id="prewedding-services"></div>
    <div id="step2-btns" class="nav-buttons"></div>
  </div>
  <div id="step3" class="step">
    <h2>3. Duração e Início</h2>
    <select id="coverage-duration"></select>
    <input type="time" id="start-time" />
    <div id="step3-btns" class="nav-buttons"></div>
  </div>
  <div id="step4" class="step">
    <h2>4. Serviços de Cobertura</h2>
    <div id="coverage-services"></div>
    <div id="step4-btns" class="nav-buttons"></div>
  </div>
  <div id="step5" class="step">
    <h2>5. Estilos de Vídeo</h2>
    <div id="video-styles"></div>
    <div id="step5-btns" class="nav-buttons"></div>
  </div>
  <div id="step6" class="step">
    <h2>6. Local e Adicionais</h2>
    <div id="map-pre" style="width:100%;height:50px;"></div>
    <div id="additional-services"></div>
    <div id="step6-btns" class="nav-buttons"></div>
  </div>
  <div id="step7" class="step">
    <h2>7. Resumo</h2>
    <pre id="resumo"></pre>
    <div id="step7-btns" class="nav-buttons"></div>
  </div>

  <div class="footer">© 2025 Vinicius Barbaro Films</div>
</body>
</html>
