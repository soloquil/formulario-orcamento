<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Or√ßamento Vinicius Barbaro Films</title>
  <style>
    body { margin:0; font-family:'Segoe UI',sans-serif; background:#fdfdfd url('https://www.transparenttextures.com/patterns/white-marble.png'); color:#2b2b2b; }
    header { background:#0f3d57; color:#fff; padding:1rem; text-align:center; font-size:1.8rem; }
    .step { display:none; max-width:700px; margin:2rem auto; background:#fff; padding:2rem; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.1);}   
    .step.active { display:block; }
    h2 { color:#0f3d57; margin-bottom:1rem; }
    label { display:block; margin:0.5rem 0; font-weight:500; }
    select,input[type="number"],input[type="time"] { width:48%; padding:0.5rem; margin:0.5rem 1%; border:1px solid #ccc; border-radius:6px; }
    .checkbox-group label { display:inline-block; margin-right:1rem; }
    button { background:#0f3d57; color:#fff; border:none; padding:0.8rem 1.5rem; border-radius:8px; cursor:pointer; transition:0.3s; margin:0.5rem; }
    button:hover { background:#0d2e41; }
    .nav-buttons { text-align:right; }
    .footer { text-align:center; font-size:0.8rem; color:#888; margin:2rem 0; }
  </style>
</head>
<body>
  <header>Vinicius Barbaro Films ‚Äì Or√ßamento</header>

  <script>
    let currentStep = 1, rows;
    const totalSteps = 7;
    const sel = { address:'', services:[], videoStyles:[], additional:[], pre:[], duration:'', startTime:'', preAddress:'', km:0 };

    function showStep(n) {
      for(let i=1;i<=totalSteps;i++) document.getElementById('step'+i).classList.remove('active');
      document.getElementById('step'+n).classList.add('active'); currentStep=n;
    }
    function prevStep(){ if(currentStep>1) showStep(currentStep-1); }
    function nextStep(){ if(currentStep<totalSteps) showStep(currentStep+1); }

    async function loadSheet(){
      const res=await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vSU-fqjBfA2H6XvQl7iQj04dVs3ZcpLBpfe1oDshpchCKwM5xA2YDnDo3aErtDjH0C3rq0FjxljUkjo/pub?output=csv');
      const txt=await res.text(); rows=txt.split('\n').map(r=>r.split(',')); initSteps(); showStep(1);
    }
    function findTag(t){return rows.findIndex(r=>r[0]===t);}    
    function sliceSection(start,end){const s=findTag(start),e=findTag(end);return(s>=0&&e>s)?rows.slice(s+1,e):[];}

    function initSteps(){
      // Step1: Servi√ßos, Dura√ß√£o e In√≠cio
      const serv = sliceSection('servi√ßo-de-cobertura-inicial','servi√ßo-de-cobertura-final');
      const d1 = document.getElementById('coverage-services');
      serv.forEach(r=>{ if(r[0]) d1.insertAdjacentHTML('beforeend',
        `<label class="checkbox-group"><input type="checkbox" value="${r[0]}"> ${r[0]}</label>`);
      });
      // duration
      const dur = sliceSection('dura√ß√£o-de-cobertura-inicial','dura√ß√£o-de-cobertura-final')[0]||[];
      const selDur = document.getElementById('coverage-duration'); dur.forEach((v,i)=>{ if(i>0) selDur.append(new Option(v,v)); });
      // start time input present
      document.getElementById('step1-btns').innerHTML=
        `<button onclick="nextStep()">Continuar</button>`;

      // Step2: Estilos de V√≠deo
      const vid = sliceSection('estilos-de-video-inicial','estilos-de-video-final');
      const d2 = document.getElementById('video-styles');
      vid.forEach(r=>{ if(r[0]) d2.insertAdjacentHTML('beforeend',
        `<label class="checkbox-group"><input type="checkbox" value="${r[0]}"> ${r[0]}</label>`);
      });
      document.getElementById('step2-btns').innerHTML=
        `<button onclick="prevStep()">Voltar</button><button onclick="nextStep()">Continuar</button>`;

      // Step3: Adicionais de V√≠deo
      const add = sliceSection('adicionais-de-filmagem-inicial','adicionais-de-filmagem-final');
      const d3 = document.getElementById('additional-services');
      add.forEach(r=>{ if(r[0]) d3.insertAdjacentHTML('beforeend',
        `<label class="checkbox-group"><input type="checkbox" value="${r[0]}"> ${r[0]}</label>`);
      });
      document.getElementById('step3-btns').innerHTML=
        `<button onclick="prevStep()">Voltar</button><button onclick="nextStep()">Continuar</button>`;

      // Step4: Local do Evento
      initMap('map-evento', addr=>sel.address=addr);
      document.getElementById('step4-btns').innerHTML=
        `<button onclick="prevStep()">Voltar</button><button onclick="nextStep()">Continuar</button>`;

      // Step5: Servi√ßos de Pr√©-Wedding
      const pre = sliceSection('servi√ßos-de-pr√©-wedding-inicial','servi√ßos-de-pr√©-wedding-final');
      const d5 = document.getElementById('prewedding-services');
      pre.forEach(r=>{ if(r[0]) d5.insertAdjacentHTML('beforeend',
        `<label class="checkbox-group"><input type="checkbox" value="${r[0]}"> ${r[0]}</label>`);
      });
      document.getElementById('step5-btns').innerHTML=
        `<button onclick="prevStep()">Voltar</button><button onclick="nextStep()">Continuar</button>`;

      // Step6: Local do Pr√©-Wedding
      initMap('map-pre', addr=>sel.preAddress=addr);
      document.getElementById('step6-btns').innerHTML=
        `<button onclick="prevStep()">Voltar</button><button onclick="nextStep()">Continuar</button>`;

      // Step7: Resumo e Envio
      document.getElementById('step7-btns').innerHTML=
        `<button onclick="prevStep()">Voltar</button><button onclick="enviarWhats()">Enviar WhatsApp</button>`;
    }

    function initMap(id,cb){
      const input=document.createElement('input'); input.placeholder='Busque o local';
      const div=document.getElementById(id); div.appendChild(input);
      input.onchange=()=>cb(input.value);
    }

    async function enviarWhats(){
      const nome = prompt("Digite seu nome completo:");
      const telefone = prompt("Digite seu WhatsApp para contato:");
      if (!nome || !telefone) return alert("Por favor, preencha todos os campos antes de continuar.");

      // Coleta os dados selecionados
      sel.services = [...document.querySelectorAll('#coverage-services input:checked')].map(i=>i.value);
      sel.duration = document.getElementById('coverage-duration').value;
      sel.startTime = document.getElementById('start-time').value;
      sel.videoStyles = [...document.querySelectorAll('#video-styles input:checked')].map(i=>i.value);
      sel.additional = [...document.querySelectorAll('#additional-services input:checked')].map(i=>i.value);
      sel.pre = [...document.querySelectorAll('#prewedding-services input:checked')].map(i=>i.value);

      // Monta a mensagem
      const msg = `Ol√°, me chamo ${nome} e preenchi o formul√°rio de or√ßamento:\n\n` +
        `üìç Local do Evento: ${sel.address}\n`+
        `üïì In√≠cio: ${sel.startTime} | ‚è≥ Dura√ß√£o: ${sel.duration}\n`+
        `üé• Servi√ßos do Dia: ${sel.services.join(', ') || 'Nenhum'}\n`+
        `üéû Estilos de V√≠deo: ${sel.videoStyles.join(', ') || 'Nenhum'}\n`+
        `‚ûï Adicionais: ${sel.additional.join(', ') || 'Nenhum'}\n`+
        `üíç Pr√©-Wedding: ${sel.pre.join(', ') || 'Nenhum'}\n`+
        `üìç Local do Pr√©-Wedding: ${sel.preAddress || 'N√£o informado'}\n`+
        `üì± WhatsApp para contato: ${telefone}`;

      const url = `https://wa.me/5511972790860?text=${encodeURIComponent(msg)}`;
      window.open(url, '_blank');
    }

    window.onload = loadSheet;
  </script>

  <div id="step1" class="step active">
    <h2>1. Servi√ßos do Dia</h2>
    <div id="coverage-services"></div>
    <label>Dura√ß√£o</label><select id="coverage-duration"></select>
    <label>Hor√°rio In√≠cio</label><input type="time" id="start-time" />
    <div id="step1-btns" class="nav-buttons"></div>
  </div>

  <div id="step2" class="step">
    <h2>2. Estilos de V√≠deo</h2>
    <div id="video-styles"></div>
    <div id="step2-btns" class="nav-buttons"></div>
  </div>

  <div id="step3" class="step">
    <h2>3. Adicionais de V√≠deo</h2>
    <div id="additional-services"></div>
    <div id="step3-btns" class="nav-buttons"></div>
  </div>

  <div id="step4" class="step">
    <h2>4. Local do Evento</h2>
    <div id="map-evento" style="width:100%;height:auto;"></div>
    <div id="step4-btns" class="nav-buttons"></div>
  </div>

  <div id="step5" class="step">
    <h2>5. Servi√ßos de Pr√©-Wedding</h2>
    <div id="prewedding-services"></div>
    <div id="step5-btns" class="nav-buttons"></div>
  </div>

  <div id="step6" class="step">
    <h2>6. Local do Pr√©-Wedding</h2>
    <div id="map-pre" style="width:100%;height:auto;"></div>
    <div id="step6-btns" class="nav-buttons"></div>
  </div>

  <div id="step7" class="step">
    <h2>7. Resumo e Envio</h2>
    <pre id="resumo"></pre>
    <div id="step7-btns" class="nav-buttons"></div>
  </div>

  <div class="footer">¬© 2025 Vinicius Barbaro Films</div>
</body>
</html>
